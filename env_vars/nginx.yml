---
creds_path: /var/lib/letsencrypt/dns_cloudflare_api_token.ini

certbot_create_if_missing: true
certbot_create_standalone_stop_services: []
certbot_create_command: |-
  certbot certonly --noninteractive
                  --dns-cloudflare
                  --agree-tos
                  --server 'https://acme-v02.api.letsencrypt.org/directory'
                  --dns-cloudflare-credentials '{{ creds_path }}'
                  -d {{ cert_item.domains | join(',') }}
certbot_create_method: standalone
certbot_certs:
  - domains:
    - '*.ayanides.cloud'


wildcard_domain: ayanides.cloud
nginx_vhost_template: nginx/vhost.j2
nginx_listen_ipv6: false
nginx_vhosts:
# NO HOST
  - server_name: "\"\""
    return: 444
    filename: default.conf
    locations: []

# SEMAPHORE
  - server_name: semaphore.ayanides.cloud
    server_name_redirect: semaphore.ayanides.cloud
    listen: 443 ssl http2
    locations:
      - proxy_pass: http://127.0.0.1:3000
      - proxy_pass: http://127.0.0.1:3000/api/ws
        path: /api/ws
        default: false
        extra_parameters: |
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
          proxy_set_header Origin "";

# PIHOLE
  - server_name: pihole.ayanides.cloud
    server_name_redirect: pihole.ayanides.cloud
    server_name_redirect_exceptions:
      - path: /admin/api.php
        proxy_pass: http://127.0.0.1:8000
    listen: 443 ssl http2
    locations:
      - proxy_pass: http://127.0.0.1:8000
        redirect_path: /admin

# BELT
  - server_name: "*.ayanides.cloud"
    server_name_redirect: "*.ayanides.cloud"
    listen: 443 ssl http2
    locations:
      - proxy_pass: https://192.168.1.100 # Traefik LB IP
