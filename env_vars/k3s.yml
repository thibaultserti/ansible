cilium_cli_version: 1.15.5

k3s_server_location: "/var/lib/rancher/k3s"

dns_ip: 192.168.1.40
resolv_conf: "{{ k3s_server_location }}/kubelet-custom-resolv.conf"
audit_policy_file:  "{{ k3s_server_location }}/server/audit.yaml"
audit_webhook_config_file: "{{ k3s_server_location }}/server/webhook-config.yaml"


k3s_version: v1.29.0+k3s4

extra_server_args: --flannel-backend=none --disable-network-policy
extra_agent_args: ""

server_config_yaml: |
  protect-kernel-defaults: true
  secrets-encryption: true
  kube-apiserver-arg:
    - 'audit-log-path={{ k3s_server_location }}/server/logs/audit.log'
    - 'audit-policy-file={{ audit_policy_file }}'
    - 'audit-webhook-config-file={{ audit_webhook_config_file }}'
    - 'audit-log-maxage=1'
    - 'audit-log-maxbackup=10'
    - 'audit-log-maxsize=100'
  kube-controller-manager-arg:
    - 'bind-address=0.0.0.0'
  kube-scheduler-arg:
    - 'bind-address=0.0.0.0'
  kubelet-arg:
    - 'resolv-conf={{ k3s_server_location }}/kubelet-custom-resolv.conf'


extra_manifests: |
  apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: kube-vip
    namespace: kube-system
  ---
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    annotations:
      rbac.authorization.kubernetes.io/autoupdate: "true"
    name: system:kube-vip-role
  rules:
    - apiGroups: [""]
      resources: ["services/status"]
      verbs: ["update"]
    - apiGroups: [""]
      resources: ["services", "endpoints"]
      verbs: ["list","get","watch", "update"]
    - apiGroups: [""]
      resources: ["nodes"]
      verbs: ["list","get","watch", "update", "patch"]
    - apiGroups: ["coordination.k8s.io"]
      resources: ["leases"]
      verbs: ["list", "get", "watch", "update", "create"]
    - apiGroups: ["discovery.k8s.io"]
      resources: ["endpointslices"]
      verbs: ["list","get","watch", "update"]
  ---
  kind: ClusterRoleBinding
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: system:kube-vip-binding
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: system:kube-vip-role
  subjects:
  - kind: ServiceAccount
    name: kube-vip
    namespace: kube-system
  ---
